{"ast":null,"code":"import _objectSpread from\"C:/Users/tmf13/Desktop/RJ/APP/webapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useNavigate}from'react-router-dom';import'./FindPartnerInterface.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FindPartnerInterface=_ref=>{let{userData}=_ref;const navigate=useNavigate();const[selectedRoom,setSelectedRoom]=useState(null);const[messages,setMessages]=useState({});const[newMessage,setNewMessage]=useState('');const[selectedFiles,setSelectedFiles]=useState([]);const messagesEndRef=useRef(null);const chatRooms=[{id:'basketball',name:'篮球',icon:'🏀',description:'篮球爱好者聚集地'},{id:'skateboard',name:'滑板',icon:'🛹',description:'滑板技巧交流'},{id:'music',name:'音乐',icon:'🎵',description:'音乐分享与讨论'},{id:'study',name:'学习',icon:'📚',description:'学习交流互助'},{id:'gaming',name:'游戏',icon:'🎮',description:'游戏搭子寻找'},{id:'photography',name:'摄影',icon:'📷',description:'摄影技巧分享'}];useEffect(()=>{// 从localStorage加载聊天记录\nconst savedMessages=localStorage.getItem('chatMessages');if(savedMessages){setMessages(JSON.parse(savedMessages));}},[]);useEffect(()=>{var _messagesEndRef$curre;// 滚动到最新消息\n(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages,selectedRoom]);const saveMessages=newMessages=>{setMessages(newMessages);localStorage.setItem('chatMessages',JSON.stringify(newMessages));};const sendMessage=()=>{if(!newMessage.trim()&&selectedFiles.length===0||!selectedRoom)return;const message={id:Date.now(),content:newMessage.trim(),files:selectedFiles.map(file=>({name:file.name,type:file.type,url:URL.createObjectURL(file)})),author:{nickname:userData.nickname,grade:userData.grade,class:userData.class,avatar:userData.avatar},timestamp:new Date().toISOString()};const updatedMessages=_objectSpread(_objectSpread({},messages),{},{[selectedRoom]:[...(messages[selectedRoom]||[]),message]});saveMessages(updatedMessages);setNewMessage('');setSelectedFiles([]);};const handleFileSelect=e=>{const files=Array.from(e.target.files);setSelectedFiles(files);};const formatTimestamp=timestamp=>{const date=new Date(timestamp);return date.toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'});};const getRoomMessages=roomId=>{return messages[roomId]||[];};const getLastMessage=roomId=>{const roomMessages=getRoomMessages(roomId);if(roomMessages.length===0)return'暂无消息';const lastMsg=roomMessages[roomMessages.length-1];if(lastMsg.content){return lastMsg.content.length>20?lastMsg.content.substring(0,20)+'...':lastMsg.content;}if(lastMsg.files.length>0){return lastMsg.files[0].type.startsWith('image/')?'[图片]':'[文件]';}return'暂无消息';};const getUnreadCount=roomId=>{// 这里可以实现未读消息计数逻辑\nreturn Math.floor(Math.random()*5);// 示例：随机未读数\n};const handleKeyPress=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}};if(selectedRoom){const room=chatRooms.find(r=>r.id===selectedRoom);const roomMessages=getRoomMessages(selectedRoom);return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-room\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:()=>setSelectedRoom(null),children:\"\\u2190 \\u8FD4\\u56DE\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"room-icon\",children:room.icon}),/*#__PURE__*/_jsx(\"span\",{className:\"room-name\",children:room.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-members\",children:[\"\\u5728\\u7EBF \",Math.floor(Math.random()*50)+10]})]}),/*#__PURE__*/_jsx(\"main\",{className:\"messages-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"messages-list\",children:[roomMessages.length>0?roomMessages.map(message=>/*#__PURE__*/_jsxs(\"div\",{className:\"message-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-avatar\",children:message.author.avatar?/*#__PURE__*/_jsx(\"img\",{src:message.author.avatar,alt:\"\\u5934\\u50CF\"}):message.author.nickname.charAt(0)}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"message-author\",children:message.author.nickname}),/*#__PURE__*/_jsxs(\"span\",{className:\"message-meta\",children:[message.author.grade,\" \",message.author.class]}),/*#__PURE__*/_jsx(\"span\",{className:\"message-time\",children:formatTimestamp(message.timestamp)})]}),message.content&&/*#__PURE__*/_jsx(\"div\",{className:\"message-text\",children:message.content}),message.files.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"message-files\",children:message.files.map((file,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"message-file\",children:file.type.startsWith('image/')?/*#__PURE__*/_jsx(\"img\",{src:file.url,alt:file.name,className:\"message-image\"}):file.type.startsWith('video/')?/*#__PURE__*/_jsx(\"video\",{src:file.url,controls:true,className:\"message-video\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"file-placeholder\",children:[\"\\uD83D\\uDCCE \",file.name]})},index))})]})]},message.id)):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-messages\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-icon\",children:room.icon}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\u6B22\\u8FCE\\u6765\\u5230\",room.name,\"\\u804A\\u5929\\u5BA4\\uFF01\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u5F00\\u59CB\\u804A\\u5929\\uFF0C\\u8BA4\\u8BC6\\u65B0\\u670B\\u53CB\\u5427\\uFF5E\"})]}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})}),/*#__PURE__*/_jsxs(\"footer\",{className:\"message-input-area\",children:[selectedFiles.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"selected-files-preview\",children:selectedFiles.map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"selected-file-item\",children:[/*#__PURE__*/_jsx(\"span\",{children:file.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedFiles(files=>files.filter((_,i)=>i!==index)),children:\"\\xD7\"})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-row\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"file-btn\",children:[\"\\uD83D\\uDCCE\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,accept:\"image/*,video/*\",onChange:handleFileSelect,style:{display:'none'}})]}),/*#__PURE__*/_jsx(\"textarea\",{className:\"message-input\",value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:handleKeyPress,placeholder:\"\\u8F93\\u5165\\u6D88\\u606F... (Shift+Enter\\u6362\\u884C)\",rows:\"1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"send-btn\",onClick:sendMessage,disabled:!newMessage.trim()&&selectedFiles.length===0,children:\"\\u53D1\\u9001\"})]})]})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"find-partner-interface\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"partner-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:()=>navigate('/'),children:\"\\u2190 \\u8FD4\\u56DE\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"\\u627E\\u642D\\u5B50\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"online-count\",children:[\"\\u5728\\u7EBF \",Math.floor(Math.random()*200)+100]})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"rooms-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rooms-list\",children:chatRooms.map(room=>{const unreadCount=getUnreadCount(room.id);return/*#__PURE__*/_jsxs(\"div\",{className:\"room-item\",onClick:()=>setSelectedRoom(room.id),children:[/*#__PURE__*/_jsx(\"div\",{className:\"room-icon-large\",children:room.icon}),/*#__PURE__*/_jsxs(\"div\",{className:\"room-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"room-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"room-name\",children:room.name}),unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"unread-badge\",children:unreadCount})]}),/*#__PURE__*/_jsx(\"p\",{className:\"room-description\",children:room.description}),/*#__PURE__*/_jsx(\"div\",{className:\"room-last-message\",children:getLastMessage(room.id)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"room-arrow\",children:\"\\u2192\"})]},room.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"tips-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCA1 \\u804A\\u5929\\u5C0F\\u8D34\\u58EB\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u4FDD\\u6301\\u53CB\\u5584\\uFF0C\\u5C0A\\u91CD\\u4ED6\\u4EBA\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u5206\\u4EAB\\u6709\\u8DA3\\u7684\\u8BDD\\u9898\\u548C\\u7ECF\\u9A8C\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u627E\\u5230\\u5FD7\\u540C\\u9053\\u5408\\u7684\\u670B\\u53CB\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u9075\\u5B88\\u804A\\u5929\\u5BA4\\u89C4\\u5219\"})]})]})]})]});};export default FindPartnerInterface;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}