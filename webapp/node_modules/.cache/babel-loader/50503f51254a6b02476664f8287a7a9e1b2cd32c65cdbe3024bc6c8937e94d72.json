{"ast":null,"code":"import _objectSpread from\"C:/Users/tmf13/Desktop/RJ/APP/webapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import'./ListenToWindInterface.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ListenToWindInterface=_ref=>{let{userData}=_ref;const navigate=useNavigate();const[activeTab,setActiveTab]=useState('å€¾è¯‰ä¸€ä¸‹');const[posts,setPosts]=useState({'å€¾è¯‰ä¸€ä¸‹':[],'åæ§½ä¸€ä¸‹':[],'å‹‡æ•¢è¡¨ç™½':[],'ä¸€çž¬ç¾Žæ™¯':[]});const[showPostModal,setShowPostModal]=useState(false);const[postContent,setPostContent]=useState('');const[selectedFiles,setSelectedFiles]=useState([]);const[isAnonymous,setIsAnonymous]=useState(false);const[showSuccess,setShowSuccess]=useState(false);const[showCommentModal,setShowCommentModal]=useState(false);const[selectedPost,setSelectedPost]=useState(null);const[commentContent,setCommentContent]=useState('');const tabs=['å€¾è¯‰ä¸€ä¸‹','åæ§½ä¸€ä¸‹','å‹‡æ•¢è¡¨ç™½','ä¸€çž¬ç¾Žæ™¯'];useEffect(()=>{// ä»ŽlocalStorageåŠ è½½å¸–å­æ•°æ®\nconst savedPosts=localStorage.getItem('listenToWindPosts');if(savedPosts){setPosts(JSON.parse(savedPosts));}},[]);const savePosts=newPosts=>{setPosts(newPosts);localStorage.setItem('listenToWindPosts',JSON.stringify(newPosts));};const handleFileSelect=e=>{const files=Array.from(e.target.files);setSelectedFiles(files);};const submitPost=()=>{if(!postContent.trim()&&selectedFiles.length===0)return;const newPost={id:Date.now(),content:postContent.trim(),files:selectedFiles.map(file=>({name:file.name,type:file.type,url:URL.createObjectURL(file)})),author:isAnonymous?{nickname:\"\".concat(userData.grade,\"\\u5E74\\u7EA7 \").concat(getGenderDisplay()),isAnonymous:true}:{nickname:userData.nickname,grade:userData.grade,class:userData.class,name:userData.name,isAnonymous:false},timestamp:new Date().toISOString(),comments:[]};const updatedPosts=_objectSpread(_objectSpread({},posts),{},{[activeTab]:[newPost,...posts[activeTab]]});savePosts(updatedPosts);setPostContent('');setSelectedFiles([]);setShowPostModal(false);// æ˜¾ç¤ºæˆåŠŸæç¤º\nsetShowSuccess(true);setTimeout(()=>setShowSuccess(false),1000);};const getGenderDisplay=()=>{// è¿™é‡Œå¯ä»¥æ ¹æ®ç”¨æˆ·è®¾ç½®è¿”å›žæ€§åˆ«ï¼Œæš‚æ—¶è¿”å›žé»˜è®¤å€¼\nreturn'ç”·';};const openCommentModal=post=>{setSelectedPost(post);setShowCommentModal(true);};const submitComment=()=>{if(!commentContent.trim())return;const newComment={id:Date.now(),content:commentContent.trim(),author:{nickname:userData.nickname,grade:userData.grade,class:userData.class},timestamp:new Date().toISOString()};const updatedPosts=_objectSpread({},posts);const postIndex=updatedPosts[activeTab].findIndex(p=>p.id===selectedPost.id);if(postIndex!==-1){updatedPosts[activeTab][postIndex].comments.push(newComment);savePosts(updatedPosts);}setCommentContent('');setShowCommentModal(false);};const formatTimestamp=timestamp=>{const date=new Date(timestamp);const now=new Date();const diff=now-date;if(diff<60000)return'åˆšåˆš';if(diff<3600000)return\"\".concat(Math.floor(diff/60000),\"\\u5206\\u949F\\u524D\");if(diff<86400000)return\"\".concat(Math.floor(diff/3600000),\"\\u5C0F\\u65F6\\u524D\");return\"\".concat(Math.floor(diff/86400000),\"\\u5929\\u524D\");};const getTabIcon=tab=>{const icons={'å€¾è¯‰ä¸€ä¸‹':'ðŸ’­','åæ§½ä¸€ä¸‹':'ðŸ˜¤','å‹‡æ•¢è¡¨ç™½':'ðŸ’•','ä¸€çž¬ç¾Žæ™¯':'ðŸ“¸'};return icons[tab];};return/*#__PURE__*/_jsxs(\"div\",{className:\"listen-to-wind-interface\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"wind-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:()=>navigate('/'),children:\"\\u2190 \\u8FD4\\u56DE\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"\\u542C\\u98CE\\u8BF4\\u96E8\"}),/*#__PURE__*/_jsx(\"button\",{className:\"post-btn\",onClick:()=>setShowPostModal(true),children:\"+ \\u53D1\\u5E03\"})]}),/*#__PURE__*/_jsx(\"nav\",{className:\"tab-nav\",children:tabs.map(tab=>/*#__PURE__*/_jsxs(\"button\",{className:\"tab \".concat(activeTab===tab?'active':''),onClick:()=>setActiveTab(tab),children:[/*#__PURE__*/_jsx(\"span\",{className:\"tab-icon\",children:getTabIcon(tab)}),/*#__PURE__*/_jsx(\"span\",{className:\"tab-text\",children:tab})]},tab))}),/*#__PURE__*/_jsx(\"main\",{className:\"posts-content\",children:posts[activeTab].length>0?/*#__PURE__*/_jsx(\"div\",{className:\"posts-list\",children:posts[activeTab].map(post=>/*#__PURE__*/_jsxs(\"div\",{className:\"post-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"author-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"author-avatar\",children:post.author.nickname.charAt(0)}),/*#__PURE__*/_jsxs(\"div\",{className:\"author-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"author-name\",children:post.author.nickname}),!post.author.isAnonymous&&/*#__PURE__*/_jsxs(\"div\",{className:\"author-meta\",children:[post.author.grade,\" \",post.author.class]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"post-time\",children:formatTimestamp(post.timestamp)})]}),post.content&&/*#__PURE__*/_jsx(\"div\",{className:\"post-content\",children:post.content}),post.files.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"post-files\",children:post.files.map((file,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"file-item\",children:file.type.startsWith('image/')?/*#__PURE__*/_jsx(\"img\",{src:file.url,alt:file.name,className:\"post-image\"}):file.type.startsWith('video/')?/*#__PURE__*/_jsx(\"video\",{src:file.url,controls:true,className:\"post-video\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"file-placeholder\",children:[\"\\uD83D\\uDCCE \",file.name]})},index))}),/*#__PURE__*/_jsx(\"div\",{className:\"post-actions\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"comment-btn\",onClick:()=>openCommentModal(post),children:[\"\\uD83D\\uDCAC \\u7559\\u8A00 (\",post.comments.length,\")\"]})}),post.comments.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"comments-section\",children:[post.comments.slice(0,3).map(comment=>/*#__PURE__*/_jsxs(\"div\",{className:\"comment-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"comment-author\",children:comment.author.nickname}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-content\",children:comment.content}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-time\",children:formatTimestamp(comment.timestamp)})]},comment.id)),post.comments.length>3&&/*#__PURE__*/_jsxs(\"button\",{className:\"view-more-comments\",onClick:()=>openCommentModal(post),children:[\"\\u67E5\\u770B\\u5168\\u90E8 \",post.comments.length,\" \\u6761\\u7559\\u8A00\"]})]})]},post.id))}):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-icon\",children:getTabIcon(activeTab)}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u6682\\u65E0\\u5185\\u5BB9\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u6210\\u4E3A\\u7B2C\\u4E00\\u4E2A\\u5728\\\"\",activeTab,\"\\\"\\u7248\\u5757\\u53D1\\u5E03\\u5185\\u5BB9\\u7684\\u4EBA\\u5427\\uFF01\"]})]})}),showPostModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal post-modal\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\u53D1\\u5E03\\u5230 \\\"\",activeTab,\"\\\"\"]}),/*#__PURE__*/_jsx(\"textarea\",{className:\"textarea\",value:postContent,onChange:e=>setPostContent(e.target.value),placeholder:\"\\u5728\".concat(activeTab,\"\\u5206\\u4EAB\\u4F60\\u7684\\u60F3\\u6CD5...\")}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-upload\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"upload-btn\",children:[\"\\uD83D\\uDCCE \\u6DFB\\u52A0\\u56FE\\u7247/\\u89C6\\u9891\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,accept:\"image/*,video/*\",onChange:handleFileSelect,style:{display:'none'}})]}),selectedFiles.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"selected-files\",children:selectedFiles.map((file,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"selected-file\",children:file.name},index))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"anonymous-option\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:isAnonymous,onChange:e=>setIsAnonymous(e.target.checked)}),\"\\u533F\\u540D\\u53D1\\u5E03\\uFF08\\u53EA\\u663E\\u793A\\u5E74\\u7EA7\\u548C\\u6027\\u522B\\uFF09\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn cancel-btn\",onClick:()=>{setShowPostModal(false);setPostContent('');setSelectedFiles([]);setIsAnonymous(false);},children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn submit-btn\",onClick:submitPost,disabled:!postContent.trim()&&selectedFiles.length===0,children:\"\\u53D1\\u5E03\"})]})]})}),showCommentModal&&selectedPost&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal comment-modal\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u7559\\u8A00\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"original-post\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"post-author\",children:selectedPost.author.nickname}),/*#__PURE__*/_jsx(\"div\",{className:\"post-content\",children:selectedPost.content})]}),/*#__PURE__*/_jsx(\"div\",{className:\"comments-list\",children:selectedPost.comments.map(comment=>/*#__PURE__*/_jsxs(\"div\",{className:\"comment-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"comment-author\",children:comment.author.nickname}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-content\",children:comment.content}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-time\",children:formatTimestamp(comment.timestamp)})]},comment.id))}),/*#__PURE__*/_jsx(\"textarea\",{className:\"textarea\",value:commentContent,onChange:e=>setCommentContent(e.target.value),placeholder:\"\\u5199\\u4E0B\\u4F60\\u7684\\u7559\\u8A00...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn cancel-btn\",onClick:()=>{setShowCommentModal(false);setCommentContent('');setSelectedPost(null);},children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn submit-btn\",onClick:submitComment,disabled:!commentContent.trim(),children:\"\\u53D1\\u9001\"})]})]})}),showSuccess&&/*#__PURE__*/_jsx(\"div\",{className:\"success-message\",children:\"\\u6536\\u5230\\u5566\\uFF01\"})]});};export default ListenToWindInterface;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}