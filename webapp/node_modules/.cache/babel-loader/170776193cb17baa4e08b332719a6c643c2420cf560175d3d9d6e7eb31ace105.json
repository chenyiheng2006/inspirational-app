{"ast":null,"code":"import _objectSpread from\"C:/Users/tmf13/Desktop/RJ/APP/webapp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useNavigate}from'react-router-dom';import'./SettingsInterface.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SettingsInterface=_ref=>{let{userData,updateUserData}=_ref;const navigate=useNavigate();const[editingField,setEditingField]=useState(null);const[tempValues,setTempValues]=useState({});const[showSuccess,setShowSuccess]=useState('');const settingsFields=[{key:'avatar',label:'头像',type:'file',points:10},{key:'nickname',label:'昵称',type:'text',points:10},{key:'grade',label:'年级',type:'select',points:10,options:['高一','高二','高三']},{key:'class',label:'班级',type:'text',points:10},{key:'name',label:'姓名',type:'text',points:10},{key:'isAnonymous',label:'默认匿名发布',type:'checkbox',points:0}];const startEdit=field=>{setEditingField(field.key);setTempValues({[field.key]:userData[field.key]||''});};const cancelEdit=()=>{setEditingField(null);setTempValues({});};const saveEdit=field=>{const newValue=tempValues[field.key];const oldValue=userData[field.key];// 检查是否有实际更改\nif(newValue!==oldValue){// 如果是新的设置且有积分奖励\nif(field.points>0&&(!oldValue||oldValue==='')){updateUserData({[field.key]:newValue,score:userData.score+field.points});showSuccessMessage(\"\\u8BBE\\u7F6E\\u6210\\u529F\\uFF01\\u83B7\\u5F97 \".concat(field.points,\" \\u79EF\\u5206\\u5956\\u52B1\\uFF01\"));}else{updateUserData({[field.key]:newValue});showSuccessMessage('设置已保存！');}}setEditingField(null);setTempValues({});};const handleFileChange=(e,field)=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=event=>{const newValue=event.target.result;const oldValue=userData[field.key];if(field.points>0&&(!oldValue||oldValue==='')){updateUserData({[field.key]:newValue,score:userData.score+field.points});showSuccessMessage(\"\\u5934\\u50CF\\u8BBE\\u7F6E\\u6210\\u529F\\uFF01\\u83B7\\u5F97 \".concat(field.points,\" \\u79EF\\u5206\\u5956\\u52B1\\uFF01\"));}else{updateUserData({[field.key]:newValue});showSuccessMessage('头像已更新！');}};reader.readAsDataURL(file);}};const showSuccessMessage=message=>{setShowSuccess(message);setTimeout(()=>setShowSuccess(''),2000);};const getFieldValue=field=>{if(editingField===field.key){return tempValues[field.key];}return userData[field.key]||'';};const getFieldDisplay=field=>{const value=userData[field.key];if(field.key==='avatar'){if(value){return/*#__PURE__*/_jsx(\"img\",{src:value,alt:\"\\u5934\\u50CF\",className:\"avatar-preview\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"avatar-placeholder\",children:\"\\u672A\\u8BBE\\u7F6E\\u5934\\u50CF\"});}if(field.key==='isAnonymous'){return value?'开启':'关闭';}return value||'未设置';};const hasValue=field=>{const value=userData[field.key];return value&&value!=='';};const getTotalCompletedSettings=()=>{return settingsFields.filter(field=>field.points>0&&hasValue(field)).length;};const getTotalPossiblePoints=()=>{return settingsFields.reduce((total,field)=>total+field.points,0);};return/*#__PURE__*/_jsxs(\"div\",{className:\"settings-interface\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"settings-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:()=>navigate('/'),children:\"\\u2190 \\u8FD4\\u56DE\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"\\u4E2A\\u4EBA\\u8BBE\\u7F6E\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"completion-status\",children:[getTotalCompletedSettings(),\"/\",settingsFields.filter(f=>f.points>0).length]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"score-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"score-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-icon\",children:\"\\uD83C\\uDFC6\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-number\",children:userData.score}),/*#__PURE__*/_jsx(\"div\",{className:\"score-label\",children:\"\\u603B\\u79EF\\u5206\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-progress\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"progress-text\",children:[\"\\u5B8C\\u5584\\u5EA6: \",Math.round(userData.score/getTotalPossiblePoints()*100),\"%\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress-fill\",style:{width:\"\".concat(userData.score/getTotalPossiblePoints()*100,\"%\")}})})]})]})}),/*#__PURE__*/_jsxs(\"main\",{className:\"settings-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"settings-list\",children:settingsFields.map(field=>{var _tempValues$field$key;return/*#__PURE__*/_jsxs(\"div\",{className:\"setting-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"setting-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"setting-label\",children:[field.label,field.points>0&&!hasValue(field)&&/*#__PURE__*/_jsxs(\"span\",{className:\"points-badge\",children:[\"+\",field.points,\"\\u5206\"]}),hasValue(field)&&/*#__PURE__*/_jsx(\"span\",{className:\"completed-badge\",children:\"\\u2713\"})]}),editingField!==field.key&&/*#__PURE__*/_jsx(\"button\",{className:\"edit-btn\",onClick:()=>startEdit(field),children:\"\\u7F16\\u8F91\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"setting-content\",children:editingField===field.key?/*#__PURE__*/_jsxs(\"div\",{className:\"setting-edit\",children:[field.type==='text'&&/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"input\",value:getFieldValue(field),onChange:e=>setTempValues(_objectSpread(_objectSpread({},tempValues),{},{[field.key]:e.target.value})),placeholder:\"\\u8BF7\\u8F93\\u5165\".concat(field.label),autoFocus:true}),field.type==='select'&&/*#__PURE__*/_jsxs(\"select\",{className:\"input\",value:getFieldValue(field),onChange:e=>setTempValues(_objectSpread(_objectSpread({},tempValues),{},{[field.key]:e.target.value})),children:[/*#__PURE__*/_jsxs(\"option\",{value:\"\",children:[\"\\u8BF7\\u9009\\u62E9\",field.label]}),field.options.map(option=>/*#__PURE__*/_jsx(\"option\",{value:option,children:option},option))]}),field.type==='checkbox'&&/*#__PURE__*/_jsxs(\"label\",{className:\"checkbox-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:getFieldValue(field),onChange:e=>setTempValues(_objectSpread(_objectSpread({},tempValues),{},{[field.key]:e.target.checked}))}),getFieldValue(field)?'开启匿名模式':'关闭匿名模式']}),/*#__PURE__*/_jsxs(\"div\",{className:\"edit-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn cancel-btn\",onClick:cancelEdit,children:\"\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn save-btn\",onClick:()=>saveEdit(field),disabled:field.type==='text'&&!((_tempValues$field$key=tempValues[field.key])!==null&&_tempValues$field$key!==void 0&&_tempValues$field$key.trim()),children:\"\\u4FDD\\u5B58\"})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"setting-display\",children:field.type==='file'?/*#__PURE__*/_jsxs(\"div\",{className:\"file-setting\",children:[getFieldDisplay(field),/*#__PURE__*/_jsxs(\"label\",{className:\"upload-btn\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>handleFileChange(e,field),style:{display:'none'}}),hasValue(field)?'更换头像':'上传头像']})]}):/*#__PURE__*/_jsx(\"div\",{className:\"field-value\",children:getFieldDisplay(field)})})})]},field.key);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"points-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83C\\uDFAF \\u79EF\\u5206\\u83B7\\u53D6\\u8BF4\\u660E\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u9996\\u6B21\\u8BBE\\u7F6E\\u5934\\u50CF\\uFF1A+10\\u5206\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u9996\\u6B21\\u8BBE\\u7F6E\\u6635\\u79F0\\uFF1A+10\\u5206\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u9996\\u6B21\\u8BBE\\u7F6E\\u5E74\\u7EA7\\uFF1A+10\\u5206\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u9996\\u6B21\\u8BBE\\u7F6E\\u73ED\\u7EA7\\uFF1A+10\\u5206\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u9996\\u6B21\\u8BBE\\u7F6E\\u59D3\\u540D\\uFF1A+10\\u5206\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u5B8C\\u5584\\u6240\\u6709\\u4FE1\\u606F\\u53EF\\u83B7\\u5F97\\u603B\\u8BA150\\u5206\\uFF01\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"other-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"action-btn danger-btn\",onClick:()=>{if(window.confirm('确定要清除所有数据吗？此操作不可恢复！')){localStorage.clear();updateUserData({avatar:null,nickname:'用户',grade:'高一',class:'1班',name:'张三',score:0,isAnonymous:false});showSuccessMessage('数据已清除！');}},children:\"\\uD83D\\uDDD1\\uFE0F \\u6E05\\u9664\\u6240\\u6709\\u6570\\u636E\"})})]}),showSuccess&&/*#__PURE__*/_jsx(\"div\",{className:\"success-message\",children:showSuccess})]});};export default SettingsInterface;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}